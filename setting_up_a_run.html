<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Setting up a run &#8212; Brioche 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=51b770b3"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Results" href="results.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="setting-up-a-run">
<h1>Setting up a run<a class="headerlink" href="#setting-up-a-run" title="Link to this heading">¶</a></h1>
<section id="brioche-inputs">
<h2>Brioche inputs:<a class="headerlink" href="#brioche-inputs" title="Link to this heading">¶</a></h2>
<p>Brioche has one required input file (the brioche targets file) which is formatted as a TSV file with the following columns:</p>
<ol class="arabic simple">
<li><p><strong>ID</strong> — the name of each marker</p></li>
<li><p><strong>Sequence</strong> — the sequence to test for uniqueness and mapping in Brioche, with the target SNP position replaced with a non-ACGT character (e.g., <code class="docutils literal notranslate"><span class="pre">D</span></code> or <code class="docutils literal notranslate"><span class="pre">X</span></code>)</p></li>
<li><p><strong>Target.bp</strong> — the position of the SNP site of interest in the sequence provided</p></li>
<li><p><strong>Target.base</strong> — a description of the REF/ALT of the expected SNP in the format <code class="docutils literal notranslate"><span class="pre">[REF/ALT]</span></code> for the marker</p></li>
</ol>
<a class="reference internal image-reference" href="_images/brioche_targets_file.png"><img alt="Targets file" class="align-center" src="_images/brioche_targets_file.png" style="width: 300px;" />
</a>
<p>This file can be created manually by the user.</p>
<p>Alternatively some of the scripts in the Additional_funtions/ folder may assist</p>
<p>e.g., If you have a VCF file and want to extract sequences from it to run Brioche you can run the file run_convert_vcf_to_brioche_input.sh</p>
<p>Options:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--vcfin</span></code> — your VCF file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--refgenome</span></code> — the reference genome to extract flanking sequence from</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--left</span></code> — size of the fragment to the left (upstream) of the SNP to return (e.g. 50 bp upstream of SNP). Value can be 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--right</span></code> — size of the fragment to the right (downstream) of the SNP to return (e.g. 50 bp downstream of SNP) Value can be 0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--chrommapping</span></code> — pairwise chromosome-name mapping file (use if the VCF chrom names differ from the reference)</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd Additional_funtions/</span>
<span class="go">bash run_convert_vcf_to_brioche_input.sh \</span>
<span class="go">--vcfin file.vcf.gz \</span>
<span class="go">--refgenome genome1.fa \</span>
<span class="go">--left 50 \</span>
<span class="go">--right 2 \</span>
<span class="go">--chrommapping chrom_mapping.tsv \</span>
<span class="go">--outdir ./brioche_out</span>
</pre></div>
</div>
<p>Or if you have a DArT report in 1 row format (1 marker per row and 1 row per marker). This requires R +v4.0.0 to either be installed as a module or for the user to install through conda. It also requires the installation of the R package “stringi” which occurs inside the script. The user can either install R directly or install the brioche-vcf conda environment and activate it before running this script (see the Installation section for build_brioche-vcf_env.sh).</p>
<p>Note: this script extracts based on the presence first of the column header AlleleSequence from the DArT report followed by common variants (AlleleSequenceRef etc), the TrimmedSequence (plus variants) can be used instead if preferred by changing the list of columns at to preference in the R script (Ln 93).</p>
<p>Options:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--dartfile</span></code> — path to the 1-row format DArT report file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--targetmarker</span></code> — letter to replace the SNP site with (e.g. <code class="docutils literal notranslate"><span class="pre">D</span></code> or <code class="docutils literal notranslate"><span class="pre">X</span></code> or <code class="docutils literal notranslate"><span class="pre">N</span></code>)</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd Additional_funtions/</span>
<span class="go">module load R4.4.0</span>
<span class="go">Rscript DArT2Brioche_convert.R \</span>
<span class="go">--dartfile &quot;dart_testing_build_briochefiles.csv&quot; \</span>
<span class="go">--targetmarker &quot;D&quot;</span>
</pre></div>
</div>
</section>
<section id="parameters-file">
<h2>Parameters file:<a class="headerlink" href="#parameters-file" title="Link to this heading">¶</a></h2>
<p>The parameters file for each run of brioche is found in the file params.config.</p>
<p>This file can be found in the brioche/ directory and has been populated with a number of default settings allowing for quick running of data.</p>
<p>This file can be renamed so long as the variable –paramfile in the nextflow run (e.g., example_run_script_brioche.sh) is updated to the new name; otherwise the run will default to params.config.</p>
<p>There are 41 different parameter settings that can be changed in Brioche with a description of what each does and what each can be set to within the parameters file.</p>
<a class="reference internal image-reference" href="_images/paramsfile.png"><img alt="Parameters file" class="align-center" src="_images/paramsfile.png" style="width: 300px;" />
</a>
<p>These parameters can broadly be categorised into 6 groups of variables with some of the main listed below.</p>
<section id="run-execution-settings">
<h3>1. Run execution settings<a class="headerlink" href="#run-execution-settings" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>mode (whether to run as test or prod for real or test data)</p></li>
<li><p>notifications (whether to receive an email upon completion)</p></li>
<li><p>resultsdir (where to save results)</p></li>
</ol>
</section>
<section id="slurm-settings">
<h3>2. slurm settings<a class="headerlink" href="#slurm-settings" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>hpcaccount (the account name sbatch jobs should have to run)</p></li>
<li><p>shortqueue (the queue/partition for jobs which take &lt;12 hours)</p></li>
<li><p>longqueue (the queue/partition for jobs which take &gt;12 hours)</p></li>
<li><p>queuesize (the maximum number of slurmjobs to submit at any given time)</p></li>
</ol>
</section>
<section id="blastn-settings">
<h3>3. BLASTn settings<a class="headerlink" href="#blastn-settings" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>evalue (minimum evalue to report BLASTn hits)</p></li>
<li><p>dust (whether to filter highly redundant sequences and not return any results e.g., long strings of CGCG or Ns)</p></li>
<li><p>otherblastoptions (any other BLASTn specific parameter to use e.g., –wordsize)</p></li>
<li><p>querychuncksize (Maximum number of markers parsed to BLASTn. If increased, memory requirements increase but can lead to small increases in speed)</p></li>
</ol>
</section>
<section id="filtering-options">
<h3>4. Filtering options<a class="headerlink" href="#filtering-options" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>coverage (the minimum coverage required to pass the coverage filter)</p></li>
<li><p>pident (the minimum pairwise identity between the marker sequence and reference genome segment to pass the identity filter)</p></li>
<li><p>maximumhits (the maximum number of BLASTn hits a marker can have before the marker is filtered out)</p></li>
<li><p>istarget3primeend (whether to filter sequences which have mutations at the 3’ end of the sequence, relevant for probe and SNP chip design data)</p></li>
<li><p>extendablebps (the number of bases required to be identical from 3’ if istarget3primend is set to TRUE)</p></li>
<li><p>keeplocalduppos (whether to treat local duplications within a small range of the genome as unique and map to the first copy or redundant and filter [will filter if the SNP site differs regardless of what this is set to])</p></li>
<li><p>localdupdist (the distance upstream and downstream in base pairs to search for local duplications if keeplocalduppos is set to ‘yes’)</p></li>
</ol>
</section>
<section id="anaylsis-scope-restricting-settings">
<h3>5. Anaylsis scope restricting settings<a class="headerlink" href="#anaylsis-scope-restricting-settings" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>restrict2chrom (only analyse hits against this chromosome of the reference genome)</p></li>
<li><p>chromstoexclude (a list of chromosomes to exclude from the reference genome)</p></li>
</ol>
</section>
<section id="providing-supplemental-biological-information-to-assist-with-determining-optimal-marker-positions">
<h3>6. Providing supplemental biological information to assist with determining optimal marker positions<a class="headerlink" href="#providing-supplemental-biological-information-to-assist-with-determining-optimal-marker-positions" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>usetargetchrom (whether to use a pairwise list of preference chromosomes to match each marker to. Will result in equal quality hits across multiple chromosomes being preferenced to target chromosome and uniquely positioned)</p></li>
<li><p>markertargetsites (two column csv which lists each marker and the chromosome to map to [chromosomes can be in the old reference genome chromosome name], see example_files/targetchromsknownmarkers.csv)</p></li>
<li><p>chromchrommatch (a two column csv listing the names of the original reference genome chromosomes and the equivalent chromosome name for the new genome, see example_files/Chromesome-chromosome_mappings.csv)</p></li>
<li><p>usesharedmarkersmap (whether to use a csv list of closely linked marker names to inform the relative position of each marker. Will result in equal quality hits across multiple chromosomes/within a chromosome being preferenced to target a position closest in bp on the reference genome to the given linked markers and causing this marker to report as uniquely positioned)</p></li>
<li><p>similarmarkersmap (a multicolumn csv file which lists the target marker in the leftmost column and closely linked markers in the following columns, see example_files/linkedSNPs.csv)</p></li>
<li><p>useldedgemap (whether to use a raw linkage disequilibrium table between markers to match the optimal marker position on the genome. Will result in equal quality hits across/within chromosomes being preferenced to target the position which has the lowest bp distance from the most closely linked markers and cause this marker to report as uniquely positioned)</p></li>
<li><p>ldedgemap (the path to a pairwise linkage disequilibrium output table [format PLINK, TASSEL, HAPLOVIEW long tables] for linkage disequilibrium scores, see example_files/examplelinkagedisequalibriumfile.ld )</p></li>
<li><p>usegeneticmap (whether to use a genetic mapping file to infirm on the relative position of each marker. Will result in equal quality hits across multiple chromosomes being preferenced to target the identified chromosome by genetic mapping. Will also result in markers which map across multiple chromosomes in genetic mapping to be marked as not unique if any hits to those secondary chromosomes and which passed identity/coverage filtering  were found from BLASTn)</p></li>
<li><p>geneticmap (the path to a multicolumn csv with the first column being the marker name, the second the number of chromosomes this marker mapped to, the next 5 being the chromosome names it mapped to, and the next 5 columns being the counts which each chromosome was mapped to for the marker, see example_files/genetic_mapping_input.csv. Note, also requires chromchrommatch to be present to convert chrom names between old and new references)</p></li>
</ol>
</section>
</section>
<section id="run-parameters-and-goals">
<h2>Run parameters and goals<a class="headerlink" href="#run-parameters-and-goals" title="Link to this heading">¶</a></h2>
<p>The run configuration you choose depends on your workflow goal. We provide a more detailed breakdown of how some settings can be changed to best run for different usecases below but in general the settings desired should reflect</p>
<section id="the-nature-of-your-data-and-the-reference">
<h3>1. The nature of your data and the reference<a class="headerlink" href="#the-nature-of-your-data-and-the-reference" title="Link to this heading">¶</a></h3>
<p>e.g., If your data is a probe design that is highly specific then a high coverage and identity is best to reflect the high specificty expected in your data.</p>
<p>e.g., If you know that the reference sequence you are mapping to is fairly diverged coverage and identity should be slightly lower to reflect the expected divergence outside of the SNP site.</p>
<p>e.g., If your data is generated from more redundancy based methods e.g., reduced represenation sequencing there will likely be a very large number of markers that are not fully unique and so settings should reflect this fact</p>
</section>
<section id="the-purpose-of-the-newly-anchored-data">
<h3>2. The purpose of the newly anchored data<a class="headerlink" href="#the-purpose-of-the-newly-anchored-data" title="Link to this heading">¶</a></h3>
<p>e.g., If the intention is to identify strictly mapping data for position sensitive analyses (e.g., imputation) then settings should be conservative as it is more important to remove any potentially non uniquely mapped markers</p>
</section>
<section id="settings-are-not-linear-conservative-liberal">
<h3>3. Settings are not linear conservative/liberal<a class="headerlink" href="#settings-are-not-linear-conservative-liberal" title="Link to this heading">¶</a></h3>
<p>Lastly, consider that certain settings may result in more/fewer markers being mapped uniquely but this relationship is not necessarily linear. e</p>
<p>e.g., while increasing the pident and coverage thresholds increases the number of markers which failed at this early filtering step, it might also remove poorly mapping hits for markers resulting in only unique hits remaining and increasing the final
number of uniquely mapping markers.</p>
<p>This is why either setting setting to reflect the nature of the data (point 1) or exploring the results of multiple runs is recommended (see Additional_functions/Run_brioche_optimise.sh)</p>
<p>Other specific goals and scenarios can be seen in the example of different usecases.</p>
<ul class="simple">
<li><p><a class="reference internal" href="usecases/usecase1_remapping.html"><span class="doc">Usecase1: Remapping data across reference genomes</span></a></p></li>
<li><p><a class="reference internal" href="usecases/usecase2_insilico_genotyping.html"><span class="doc">Usecase2: In silico genotyping of reference genomes</span></a></p></li>
<li><p><a class="reference internal" href="usecases/usecase3_redundancy_accuracy.html"><span class="doc">Usecase3: Testing redundancy/accuracy in marker datasets</span></a></p></li>
<li><p><a class="reference internal" href="usecases/usecase4_merge_datasets.html"><span class="doc">Usecase5: Merge datasets</span></a></p></li>
</ul>
</section>
</section>
<section id="simple-runs">
<h2>Simple runs<a class="headerlink" href="#simple-runs" title="Link to this heading">¶</a></h2>
<p>Once parameters are set and the targets file (Brioche input file) is created running Brioche is very straight forward.</p>
<p>In the brioche landing directory there is an example .sh file for running Brioche, example_run_script_brioche.sh</p>
<p>In this file you will need to:</p>
<ol class="arabic">
<li><p>Update the Slurm <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Multithreaded (SMP) job: must run on one node</span>
<span class="c1">#SBATCH --nodes=1</span>

<span class="c1"># The name of the job:</span>
<span class="c1">#SBATCH --job-name=&quot;example_slurmjob&quot;</span>

<span class="c1"># The project ID which this job should run under:</span>
<span class="c1">#SBATCH --account=&quot;default&quot;</span>

<span class="c1"># The partition in which to submit the job:</span>
<span class="c1">#SBATCH --partition=&quot;batch&quot;</span>

<span class="c1"># Maximum number of tasks/CPU cores used by the job:</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --cpus-per-task=8</span>

<span class="c1"># The total amount of memory in the job:</span>
<span class="c1">#SBATCH --mem=40GB</span>

<span class="c1"># Send yourself an email when the job fails:</span>
<span class="c1">#SBATCH --mail-type=FAIL</span>
<span class="c1">#SBATCH --mail-user=user123@mail.mail</span>

<span class="c1"># The maximum running time:</span>
<span class="c1">#SBATCH --time=24:0:00</span>
</pre></div>
</div>
</li>
<li><p>Update the run settings (paths, targets file, and required modules).</p>
<p>Paying special attention to the targets file and making sure Nextflow, conda, and git are available (via <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span></code> or your own installation):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build target table for the new brioche format</span>
<span class="nv">target</span><span class="o">=</span>/filepath/briochetargetdesign.tsv

<span class="c1"># Used in naming of results files</span>
<span class="nv">chipname</span><span class="o">=</span><span class="s2">&quot;probename&quot;</span>

<span class="c1"># Directory of reference genome</span>
<span class="nv">genomedir</span><span class="o">=</span>/filepathgenome/

<span class="c1"># Genome name without extension</span>
<span class="nv">genome</span><span class="o">=</span><span class="s2">&quot;genomename&quot;</span>

<span class="c1"># Genome name with extension</span>
<span class="nv">fasta</span><span class="o">=</span><span class="s2">&quot;genomename.fa&quot;</span>

<span class="c1"># Param file can be set as anything, but if not set in the Nextflow command below,</span>
<span class="c1"># it will default to the params.config in the same directory as main.nf</span>
<span class="nv">params</span><span class="o">=</span><span class="s2">&quot;/filepath/brioche/params.config&quot;</span>
<span class="nv">briochemain</span><span class="o">=</span><span class="s2">&quot;/filepath/brioche/main.nf&quot;</span>

<span class="c1"># Required modules</span>
module<span class="w"> </span>load<span class="w"> </span>Nextflow
module<span class="w"> </span>load<span class="w"> </span>Miniconda3
module<span class="w"> </span>load<span class="w"> </span>git

<span class="nv">workdir</span><span class="o">=</span><span class="s2">&quot;/filepath/brioche/results/</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">chipname</span><span class="si">}</span><span class="s2">/&quot;</span>
<span class="nv">resultsdir</span><span class="o">=</span><span class="s2">&quot;/filepath/brioche/results/</span><span class="si">${</span><span class="nv">genome</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">chipname</span><span class="si">}</span><span class="s2">/&quot;</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">resultsdir</span><span class="si">}</span><span class="s2">&quot;</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">workdir</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">workdir</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</li>
</ol>
<p>After updating the script can be run from a terminal with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sbatch example_run_script_brioche.sh</span>
</pre></div>
</div>
<section id="introduction">
<h3>Introduction:<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h3>
<p>To return to the Installation page go to <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a></p>
</section>
<section id="results">
<h3>Results:<a class="headerlink" href="#results" title="Link to this heading">¶</a></h3>
<p>For investigating the results of a run go to <a class="reference internal" href="results.html"><span class="doc">Results</span></a></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Brioche</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=plantinformatics&repo=brioche&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Main</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setting up a run</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#brioche-inputs">Brioche inputs:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters-file">Parameters file:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-parameters-and-goals">Run parameters and goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-runs">Simple runs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usecases/usecase1_remapping.html">Usecase1: Remapping data across reference genomes</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases/usecase2_insilico_genotyping.html">Usecase2: In silico genotyping of reference genomes</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases/usecase3_redundancy_accuracy.html">Usecase3: Testing redundancy/accuracy in marker datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="usecases/usecase4_merge_datasets.html">Usecase4: Merge datasets</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="results.html" title="next chapter">Results</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, James O'Dwyer, Gabriel Keeble-Gagnere, Kerrie L Forrest.
      
      |
      <a href="_sources/setting_up_a_run.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/plantinformatics/brioche" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>